<file name="RemoveTopic.php">
	<operation>
		<search position="after">$recycleTopics[] = $row['id_topic'];</search>
		<add>
				if(!isset($recycleBoards[$row['id_board']]))
					$recycleBoards[$row['id_board']] = array();
				$recycleBoards[$row['id_board']][] = $row['id_topic'];
		</add>
	</operation>
	<operation>
		<search position="after">$recycleTopics = array();</search>
		<add>
			// MoreRecyclingBoards: We need another array where save know in wich board the topic is
			$recycleBoards = array();
		</add>
	</operation>
	<operation>
		<search position="replace">moveTopics($recycleTopics, $settings['recycle_board']);</search>
		<add>
			// Here we overwrite the move stuff
			loadPluginSource('CerealGuy:MoreRecyclingBins', 'Subs-MoreRecyclingBins');
			$recyclingBins = get_morerecyclingbins();
			foreach($recycleBoards as $board => $topis){
				$recycle_board = find_recyclingboard($recyclingBins, $board);
				$recycle_board = ($recycle_board != false ? $recycle_board : $settings['recycle_board']);
				moveTopics($topics, $recycle_board);

			}
</add>
	</operation>



	<operation>
		<search position="after">if (!empty($settings['recycle_enable']) && $row['id_board'] != $settings['recycle_board'] && $row['icon'] != 'recycled')
	{</search>
		<add>
		// Here we overwrite $settings['recycle_board'] (in removeMessage this is the easier way)
		loadPluginSource('CerealGuy:MoreRecyclingBins', 'Subs-MoreRecyclingBins');
		$recyclingBins = get_morerecyclingbins();
		$recycle_board = find_recyclingboard($recyclingBins, $row['id_board']);
		if($recycle_board != false)
			$old_recycle_board = $settings['recycle_board']; // we need that later!
			$settings['recycle_board'] = $recycle_board; // we are lazy just overwrite it
		
		</add>
	</operation>

	<operation>
		<search position="after">updateLastMessages($row['id_board']);</search>
		<add>
		if($recycle == true && isset($old_recycle_board))
			$settings['recycle_board'] = $old_recycle_board; // set it back otherwise we would maybe break something
		</add>
	</operation>



</file>
